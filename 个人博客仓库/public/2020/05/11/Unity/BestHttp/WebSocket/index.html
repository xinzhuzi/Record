<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BestHttpä»‹ç»2 | æ–°è¯¸å­</title>
  <meta name="keywords" content=" BestHttp ">
  <meta name="description" content="BestHttpä»‹ç»2 | æ–°è¯¸å­">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="é¡µé¢æœªæ‰¾åˆ°ï¼">
<meta property="og:type" content="website">
<meta property="og:title" content="404">
<meta property="og:url" content="http://yoursite.com/404.html">
<meta property="og:site_name" content="æ–°è¯¸å­">
<meta property="og:description" content="é¡µé¢æœªæ‰¾åˆ°ï¼">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2016-09-27T03:31:01.000Z">
<meta property="article:modified_time" content="2020-05-09T02:33:01.257Z">
<meta property="article:author" content="è¯¸å­ç™¾å®¶-è°çš„å¤©ä¸‹?">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/darcula.css?v=1.0.1" rel="stylesheet">

<link href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" rel="stylesheet">
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/fontawesome.min.js" rel="stylesheet">

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.2/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="true">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>è¯¸å­ç™¾å®¶-è°çš„å¤©ä¸‹?</span>
</div>

<div class="icon">
    
        
        <a title="rss" href="/atom.xml" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-rss"></use>
                </svg>
            
        </a>
        
    
        
        <a title="github" href="https://github.com/xinzhuzi" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="jianshu" href="https://www.jianshu.com/u/e7aab68810b1" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-jianshu"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:1487842110@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=1487842110&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
        <a title="kugou" href="https://www.kugou.com/" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-kugou"></use>
                </svg>
            
        </a>
        
    
        
        <a title="neteasemusic" href="https://music.163.com/#/user/home?id=88151013" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-neteasemusic"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">å…¨éƒ¨æ–‡ç« <small>(21)</small></div></li>
    
        
            
            <li><div data-rel="åšå®¢">åšå®¢<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="è¯—è¯éšç¬”">è¯—è¯éšç¬”<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="æ‚é¡¹">æ‚é¡¹<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="å·¥å…·">å·¥å…·<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="UnityEditor">UnityEditor<small>(13)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Unity">Unity<small>(2)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  " target="_blank" href="/about">å…³äº</a><a style="width: 50%"  class="friends">å‹é“¾</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="21">
<input type="hidden" id="yelog_site_word_count" value="46.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        å‹æƒ…é“¾æ¥
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://github.com/xinzhuzi">è¯¸å­ç™¾å®¶-è°çš„å¤©ä¸‹?</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color5">hexo</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">è¯—è¯éšç¬”</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">æ‚é¡¹</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">tool</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">UnityEditor</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">BestHttp</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="åšå®¢ "
           href="/2020/05/08/Hexo%20%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="Hexo çš„ç®€å•æ“ä½œ">Hexo çš„ç®€å•æ“ä½œ</span>
            <span class="post-date" title="2020-05-08 11:41:32">2020/05/08</span>
        </a>
        
        <a  class="åšå®¢ "
           href="/2020/05/08/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E4%BB%A5%E5%8F%8A%E7%BC%96%E5%86%99/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="åšå®¢æ­å»ºä»¥åŠç¼–å†™">åšå®¢æ­å»ºä»¥åŠç¼–å†™</span>
            <span class="post-date" title="2020-05-08 11:41:32">2020/05/08</span>
        </a>
        
        <a  class="è¯—è¯éšç¬” "
           href="/2020/05/10/%E8%AF%97%E8%AF%8D%E9%9A%8F%E7%AC%94/"
           data-tag="è¯—è¯éšç¬”"
           data-author="" >
            <span class="post-title" title="è¯—è¯éšç¬”">è¯—è¯éšç¬”</span>
            <span class="post-date" title="2020-05-10 11:41:32">2020/05/10</span>
        </a>
        
        <a  class="æ‚é¡¹ "
           href="/2020/05/08/%E5%85%B1%E4%BA%A7%E5%85%9A%E5%AE%A3%E8%A8%80/"
           data-tag="æ‚é¡¹"
           data-author="" >
            <span class="post-title" title="å…±äº§å…šå®£è¨€">å…±äº§å…šå®£è¨€</span>
            <span class="post-date" title="2020-05-08 11:41:32">2020/05/08</span>
        </a>
        
        <a  class="å·¥å…· "
           href="/2020/05/08/Tools/%E5%A5%BD%E7%94%A8%E7%9A%84%E6%8F%92%E4%BB%B6%E8%BD%AF%E4%BB%B6/"
           data-tag="tool"
           data-author="" >
            <span class="post-title" title="å¥½ç”¨çš„æ’ä»¶è½¯ä»¶">å¥½ç”¨çš„æ’ä»¶è½¯ä»¶</span>
            <span class="post-date" title="2020-05-08 11:41:32">2020/05/08</span>
        </a>
        
        <a  class="å·¥å…· "
           href="/2020/05/08/Tools/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"
           data-tag="tool"
           data-author="" >
            <span class="post-title" title="ç§‘å­¦ä¸Šç½‘">ç§‘å­¦ä¸Šç½‘</span>
            <span class="post-date" title="2020-05-08 11:41:32">2020/05/08</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/1%20%E4%BB%8B%E7%BB%8DUnityEditor/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="1 ä»‹ç»UnityEditor">1 ä»‹ç»UnityEditor</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/10%20Screenshot/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="10 Screenshot">10 Screenshot</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/11%20Handles/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="11 Handles">11 Handles</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/12%20Gizmos/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="12 Gizmos">12 Gizmos</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/13%20%E7%AE%80%E5%8D%95Node/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="13 ç®€å•Node">13 ç®€å•Node</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/3%20%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="3 æ•°æ®äº¤äº’">3 æ•°æ®äº¤äº’</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/5%20EditorWindow/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="5 EditorWindow">5 EditorWindow</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/6%20MenuItem/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="6 MenuItem">6 MenuItem</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/2%20UnityEditor%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="2 UnityEditorå¸¸ç”¨å±æ€§">2 UnityEditorå¸¸ç”¨å±æ€§</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/4%20EditorGUI/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="4 EditorGUI">4 EditorGUI</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/7%20CustomEditor_PropertyDrawer/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="7 CustomEditor_PropertyDrawer">7 CustomEditor_PropertyDrawer</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/8%20EditorGUILayout/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="8 EditorGUILayout">8 EditorGUILayout</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="UnityEditor "
           href="/2020/05/11/UnityEditor/9%20EditorWindow%E6%A1%88%E4%BE%8B1/"
           data-tag="UnityEditor"
           data-author="" >
            <span class="post-title" title="9 EditorWindowæ¡ˆä¾‹1">9 EditorWindowæ¡ˆä¾‹1</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="Unity "
           href="/2020/05/11/Unity/BestHttp/WebSocket/"
           data-tag="BestHttp"
           data-author="" >
            <span class="post-title" title="BestHttpä»‹ç»2">BestHttpä»‹ç»2</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
        <a  class="Unity "
           href="/2020/05/11/Unity/BestHttp/BestHttp%E4%BB%8B%E7%BB%8D/"
           data-tag="BestHttp"
           data-author="" >
            <span class="post-title" title="BestHttpä»‹ç»1">BestHttpä»‹ç»1</span>
            <span class="post-date" title="2020-05-11 11:41:32">2020/05/11</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Unity/BestHttp/WebSocket" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">BestHttpä»‹ç»2</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="Unity">Unity</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color4">BestHttp</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='æ›´æ–°æ—¶é—´: 2020-05-11 20:48:31'>2020-05-11 11:41</time>
        
    </div>
    <div class="article-meta">
        
        <span>å­—æ•°:7.7k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="è·³è½¬è‡³è¯„è®ºåŒº">
            <a href="#comments">
                è¯„è®º:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WebSocket"><span class="toc-text">WebSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä»‹ç»"><span class="toc-text">ä»‹ç»</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><ul>
<li><p>1:æˆ‘ä»¬å¯ä»¥é€šè¿‡WebSocketç±»ä½¿ç”¨WebSocketåŠŸèƒ½ã€‚æˆ‘ä»¬åªéœ€è¦å°†æœåŠ¡å™¨çš„Uriä¼ é€’ç»™WebSocketçš„æ„é€ å‡½æ•°</p>
</li>
<li><p>2:åˆ›å»º</p>
</li>
</ul>
<pre><code>var webSocket = new WebSocket(new Uri(&quot;wss://html5labs-interop.cloudapp.net/echo&quot;)); </code></pre><ul>
<li>3:,OnOpenäº‹ä»¶ï¼šåœ¨å»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥æ—¶è°ƒç”¨ã€‚åœ¨æ­¤äº‹ä»¶å›è°ƒä¹‹åï¼ŒWebSocketçš„IsOpenå±æ€§å°†ä¸ºTrueï¼Œç›´åˆ°æˆ‘ä»¬æˆ–æœåŠ¡å™¨å…³é—­è¿æ¥æˆ–å‘ç”Ÿé”™è¯¯ã€‚<pre><code>webSocket.OnOpen += OnWebSocketOpen; 
private void OnWebSocketOpen(WebSocket webSocket) { Debug.Log(&quot;WebSocket Open!&quot;); }</code></pre></li>
<li>4:,OnMessageäº‹ä»¶ï¼šä»æœåŠ¡å™¨æ”¶åˆ°æ–‡æœ¬æ¶ˆæ¯æ—¶è°ƒç”¨ã€‚<pre><code>webSocket.OnMessage += OnMessageReceived; 
private void OnMessageReceived(WebSocket webSocket, string message) { Debug.Log(&quot;Text Message received from server: &quot; + message); } </code></pre></li>
<li>5:,OnBinaryäº‹ä»¶ï¼šä»æœåŠ¡å™¨æ”¶åˆ°äºŒè¿›åˆ¶blobæ¶ˆæ¯æ—¶è°ƒç”¨ã€‚<pre><code>webSocket.OnBinary += OnBinaryMessageReceived; 
private void OnBinaryMessageReceived(WebSocket webSocket, byte[] message) { Debug.Log(&quot;Binary Message received from server. Length: &quot; + message.Length); }</code></pre></li>
<li>6:,OnClosedäº‹ä»¶ï¼šåœ¨å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å…³é—­è¿æ¥æ—¶è°ƒç”¨ï¼Œæˆ–å‘ç”Ÿå†…éƒ¨é”™è¯¯ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡Closeå‡½æ•°å…³é—­è¿æ¥æ—¶ï¼Œå®ƒå¯ä»¥æä¾›ä»£ç å’Œæ¶ˆæ¯ï¼ŒæŒ‡ç¤ºå…³é—­çš„åŸå› ã€‚æœåŠ¡å™¨é€šå¸¸ä¼šå›å¤æˆ‘ä»¬çš„ä»£ç å’Œæ¶ˆæ¯ã€‚<pre><code>webSocket.OnClosed += OnWebSocketClosed; 
private void OnWebSocketClosed(WebSocket webSocket, UInt16 code, string message) { Debug.Log(&quot;WebSocket Closed!&quot;);}</code></pre></li>
<li>7:OnErroräº‹ä»¶ï¼šå½“æˆ‘ä»¬æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨æ—¶è°ƒç”¨ï¼Œå‘ç”Ÿå†…éƒ¨é”™è¯¯æˆ–è¿æ¥ä¸¢å¤±ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯Exceptionå¯¹è±¡ï¼Œä½†å®ƒå¯ä»¥ä¸ºnullã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ£€æŸ¥WebSocketçš„InternalRequeståº”è¯¥å‘Šè¯‰æ›´å¤šæœ‰å…³è¯¥é—®é¢˜çš„ä¿¡æ¯ã€‚<pre><code>webSocket.OnError += OnError; 
private void OnError(WebSocket ws, Exception ex) 
{ 
      string errorMsg = string .Empty; 
      if (ws.InternalRequest.Response != null)
      {
               errorMsg = string.Format(&quot;Status Code from Server: {0} and Message: {1}&quot;, ws.InternalRequest.Response.StatusCode, ws.InternalRequest.Response.Message); 
      }
      Debug.Log(&quot;An error occured: &quot; + (ex != null ? ex.Message : &quot;Unknown: &quot; + errorMsg)); 
} </code></pre></li>
<li>8:OnErrorDescäº‹ä»¶ï¼šä¸€ä¸ªæ›´å…·ä¿¡æ¯æ€§çš„äº‹ä»¶ï¼Œæ­¤äº‹ä»¶åœ¨OnErroräº‹ä»¶ä¹‹åè°ƒç”¨,å› ä¸ºåè€…ä»…ä½¿ç”¨Exceptionå‚æ•°è°ƒç”¨ã€‚ä½†å®ƒå¯ä»¥æä¾›æ›´è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Šã€‚<pre><code>webSocket.OnErrorDesc += OnErrorDesc; 
void OnErrorDesc(WebSocket ws, string error) { Debug.Log(&quot;Error: &quot; + error); } </code></pre></li>
<li>9:åœ¨æˆ‘ä»¬å°†æ‰€æœ‰äº‹ä»¶æ³¨å†Œå®Œå¤‡ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿æ¥ï¼š<pre><code>webSocket.Open(); </code></pre>åœ¨æ­¤æ­¥éª¤ä¹‹åï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ä¸€ä¸ªOnOpenäº‹ä»¶çš„å›è°ƒï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ã€‚<pre><code>// å‘é€å­—ç¬¦ä¸²: 
webSocket.Send(&quot;Message to the Server&quot;); 
</code></pre></li>
</ul>
<p>// åˆ›å»ºäºŒè¿›åˆ¶æµ,å¹¶å¡«å……:<br>byte[] buffer = new byte[length];<br>//å‘é€äºŒè¿›åˆ¶æµ<br>webSocket.Send(buffer); </p>
<pre><code>å®Œæˆé€šä¿¡å/ä¸éœ€è¦çš„æ—¶å€™,å…³é—­é“¾æ¥,æ— æ³•é‡ç”¨å·²å…³é—­çš„WebSocketå®ä¾‹ã€‚</code></pre><p>webSocket.Close(); </p>
<pre><code>* 10:Pingæ¶ˆæ¯ï¼šé€šè¿‡åœ¨æ”¶åˆ°OnOpenäº‹ä»¶ä¹‹å‰å°†StartPingThreadå±æ€§è®¾ç½®ä¸ºTrueï¼Œå¯ä»¥å¯åŠ¨æ–°çº¿ç¨‹å°†Pingæ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ã€‚è¿™æ ·ï¼ŒPingæ¶ˆæ¯å°†å®šæœŸå‘é€åˆ°æœåŠ¡å™¨ã€‚å¯ä»¥åœ¨PingFrequencyå±æ€§ä¸­è®¾ç½®ä¸¤æ¬¡pingä¹‹é—´çš„å»¶è¿Ÿï¼ˆé»˜è®¤å€¼ä¸º1000msï¼‰.(ç›¸å½“äºè®¾ç½®å¿ƒè·³åŒ…)
* 11:Pongæ¶ˆæ¯ï¼šä»æ’ä»¶æœåŠ¡å™¨æ”¶åˆ°çš„æ‰€æœ‰pingæ¶ˆæ¯å°†è‡ªåŠ¨ç”ŸæˆPongåº”ç­”ã€‚
* 12:Streamingï¼šè¾ƒé•¿çš„æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ¶ˆæ¯å°†å˜å¾—æ”¯ç¦»ç ´ç¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç‰‡æ®µç”±æ’ä»¶è‡ªåŠ¨ç»„è£…ã€‚å¦‚æœæˆ‘ä»¬å‘WebSocketçš„OnIncompleteFrameäº‹ä»¶æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œåˆ™å¯ä»¥è¦†ç›–æ­¤æœºåˆ¶ã€‚æ¯æ¬¡å®¢æˆ·ç«¯æ”¶åˆ°ä¸å®Œæ•´çš„ç‰‡æ®µæ—¶éƒ½ä¼šè°ƒç”¨æ­¤äº‹ä»¶ã€‚è¿™äº›ç‰‡æ®µå°†è¢«æ’ä»¶å¿½ç•¥ï¼Œå®ƒä¸ä¼šå°è¯•ç»„è£…è¿™äº›ç‰‡æ®µï¼Œä¹Ÿä¸ä¼šå­˜å‚¨å®ƒä»¬ã€‚æ­¤äº‹ä»¶å¯ç”¨äºå®ç°æµå¼ä¼ è¾“ä½“éªŒã€‚(è‡ªå®šä¹‰ç»„è£…æ¶ˆæ¯).

## ä½¿ç”¨Socket.IO
* 1:Socket.IOå®ç°ä½¿ç”¨æ’ä»¶å·²æœ‰çš„åŠŸèƒ½ã€‚å½“è½®è¯¢ä¼ è¾“ä¸å…¶æ‰€æœ‰åŠŸèƒ½ï¼ˆcookieï¼Œè¿æ¥é‡ç”¨ç­‰ï¼‰ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒå°†å‘é€HTTPRequestsä»¥è·å–æ¡æ‰‹æ•°æ®ï¼Œå‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ã€‚ WebSocketå®ç°ç”¨äºWebSocketä¼ è¾“
&gt;&gt;&gt;
        1):æ˜“äºä½¿ç”¨å’Œç†Ÿæ‚‰çš„api
        2):å…¼å®¹æœ€æ–°çš„Socket.IOè§„èŒƒ
        3):ä»è½®è¯¢ä¼ è¾“åˆ°websocketä¼ è¾“çš„æ— ç¼å‡çº§
        4):æ–­å¼€æ—¶è‡ªåŠ¨é‡æ–°è¿æ¥
        5):ç®€å•é«˜æ•ˆçš„äºŒè¿›åˆ¶æ•°æ®å‘é€å’Œå¤šç§æ¥æ”¶æ–¹å¼
        6):åœ¨é«˜çº§æ¨¡å¼ä¸‹ä½¿ç”¨å®ƒçš„å¼ºå¤§å·¥å…·ï¼ˆåˆ‡æ¢é»˜è®¤ç¼–ç å™¨ï¼Œç¦ç”¨è‡ªåŠ¨è§£ç ç­‰ï¼‰
&gt;&gt;&gt;
* 2:ä½¿ç”¨.å¦‚æœè¦è¿æ¥åˆ°Socket.IOæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨BestHTTP.SocketIO.SocketManagerç±»æ¥å®Œæˆã€‚é¦–å…ˆï¼Œæ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªSocketManagerå®ä¾‹</code></pre><p>using System; using BestHTTP;<br>using BestHTTP.SocketIO;<br>var manager = new SocketManager(new Uri(â€œ<a href="http://chat.socket.io/socket.io/&quot;" target="_blank" rel="noopener">http://chat.socket.io/socket.io/&quot;</a>)); </p>
<pre><code>* 3:Urlä¸­çš„/socket.io/è·¯å¾„éå¸¸é‡è¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSocket.IOæœåŠ¡å™¨å°†ä¾¦å¬æ­¤æŸ¥è¯¢ã€‚æ‰€ä»¥ä¸è¦å¿˜è®°æµ‹è¯•ï¼
* 4:Connecting to namespaces ,é»˜è®¤æƒ…å†µä¸‹ï¼ŒSocketManagerå°†åœ¨è¿æ¥åˆ°æœåŠ¡å™¨æ—¶è¿æ¥åˆ°æ ¹ï¼ˆâ€œ/â€ï¼‰å‘½åç©ºé—´ã€‚æ‚¨å¯ä»¥é€šè¿‡SocketManagerçš„Socketå±æ€§è®¿é—®å®ƒï¼š</code></pre><p>Socket root = manager.Socket; </p>
<pre><code>å¯ä»¥é€šè¿‡GetSocketï¼ˆ&#39;/ nspName&#39;ï¼‰å‡½æ•°æˆ–é€šè¿‡managerçš„indexerå±æ€§è®¿é—®éé»˜è®¤åç§°ç©ºé—´ï¼š</code></pre><p>Socket nsp = manager[â€œ/customNamespaceâ€];<br>// ç­‰ä»·äº:<br>Socket nsp = manager.GetSocket(â€œ/customNamespaceâ€); </p>
<pre><code>é¦–æ¬¡è®¿é—®å‘½åç©ºé—´å°†å¯åŠ¨å†…éƒ¨è¿æ¥è¿‡ç¨‹
* 4:Subscribing  and receiving events ,æ‚¨å¯ä»¥è®¢é˜…é¢„å®šä¹‰å’Œè‡ªå®šä¹‰äº‹ä»¶ã€‚é¢„å®šä¹‰äº‹ä»¶æ˜¯â€œè¿æ¥â€ï¼Œâ€œè¿æ¥â€ï¼Œâ€œäº‹ä»¶â€ï¼Œâ€œæ–­å¼€è¿æ¥â€ï¼Œâ€œé‡æ–°è¿æ¥â€ï¼Œâ€œé‡æ–°è¿æ¥â€ï¼Œâ€œé‡æ–°è¿æ¥â€ï¼Œâ€œé‡æ–°è¿æ¥å¤±è´¥â€ï¼Œâ€œé”™è¯¯â€ã€‚(&quot;connect&quot;, &quot;connecting&quot;, &quot;event&quot;, &quot;disconnect&quot;, &quot;reconnect&quot;, &quot;reconnecting&quot;, &quot;reconnect_attempt&quot;, &quot;reconnect_failed&quot;, &quot;error&quot;. )è‡ªå®šä¹‰äº‹ä»¶æ˜¯ç¨‹åºå‘˜å®šä¹‰çš„äº‹ä»¶ï¼ŒæœåŠ¡å™¨å°†å‘é€ç»™æ‚¨çš„å®¢æˆ·ç«¯ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨å¥—æ¥å­—çš„Onå‡½æ•°æ¥è®¢é˜…äº‹ä»¶ï¼š</code></pre><p>manager.Socket.On(â€œloginâ€, OnLogin);<br>manager.Socket.On(â€œnew messageâ€, OnNewMessage); </p>
<p>void OnLogin(Socket socket, Packet packet, params object[] args)<br>{<br>        //Socketå‚æ•°å°†æ˜¯æœåŠ¡å™¨å‘é€æ­¤äº‹ä»¶çš„namespace-socketå¯¹è±¡<br>        //Packetå‚æ•°åŒ…å«äº‹ä»¶çš„å†…éƒ¨åˆ†ç»„æ•°æ®ã€‚æ•°æ®åŒ…å¯ç”¨äºè®¿é—®æœåŠ¡å™¨å‘é€çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæˆ–ä½¿ç”¨è‡ªå®šä¹‰Jsonè§£æå™¨libè§£ç æœ‰æ•ˆè´Ÿè½½æ•°æ®ã€‚ç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚<br>        //Argså‚æ•°æ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦æ•°ç»„ï¼ŒåŒ…å«æ¥è‡ªæ•°æ®åŒ…æœ‰æ•ˆè´Ÿè½½æ•°æ®çš„è§£ç å¯¹è±¡ã€‚ä½¿ç”¨é»˜è®¤çš„Jsonç¼–ç å™¨ï¼Œè¿™äº›å‚æ•°å¯ä»¥æ˜¯â€œåŸå§‹â€ç±»å‹ï¼ˆintï¼Œdoubleï¼Œstringï¼‰æˆ–å¯¹è±¡åˆ—è¡¨ï¼ˆListå¯¹è±¡ï¼‰æˆ–Dictionaryå­—ç¬¦ä¸²ï¼Œå¯¹è±¡å¯¹è±¡ã€‚<br>} </p>
<pre><code></code></pre><p>//æœåŠ¡å™¨ä¸Šé¢çš„ä»£ç å†™æ³•,åœ¨ä¸€ä¸ª node.js çš„æœåŠ¡å™¨ä¸Šé¢<br>socket.emit(â€˜messageâ€™, â€˜MyNickâ€™, â€˜Msg to the clientâ€™);<br>//å®¢æˆ·ç«¯æ¥æ”¶<br>// subscribe to the â€œmessageâ€ event<br>manager.Socket.On(â€œmessageâ€, OnMessage);<br>// event handler<br>void OnMessage(Socket socket, Packet packet, params object[] args)<br>{<br>        // args[0] is the nick of the sender<br>        // args[1] is the message<br>        Debug.Log(string.Format(â€œMessage from {0}: {1}â€, args[0], args[1]));<br>} </p>
<pre><code>&gt;&gt;&gt;
        â—â€œconnectâ€ï¼šå‘½åç©ºé—´æ‰“å¼€æ—¶å‘é€ã€‚ 
        â—â€œconnectingâ€ï¼šå½“SocketManagerå¼€å§‹è¿æ¥åˆ°socket.ioæœåŠ¡å™¨æ—¶å‘é€ã€‚ 
        â—â€œeventâ€ï¼šåœ¨è‡ªå®šä¹‰ï¼ˆç¨‹åºå‘˜å®šä¹‰çš„ï¼‰äº‹ä»¶ä¸Šå‘é€ã€‚ 
        â—â€œdisconnectâ€ï¼šå½“ä¼ è¾“æ–­å¼€ï¼ŒSocketManagerå…³é—­ï¼ŒSocketå…³é—­æˆ–åœ¨æ¡æ‰‹æ•°æ®ä¸­æŒ‡å®šçš„ç»™å®šæ—¶é—´å†…æ²¡æœ‰ä»æœåŠ¡å™¨æ”¶åˆ°Pongæ¶ˆæ¯æ—¶å‘é€ã€‚ 
        â—â€œreconnectâ€ï¼šæ’ä»¶æˆåŠŸé‡æ–°è¿æ¥åˆ°socket.ioæœåŠ¡å™¨æ—¶å‘é€ã€‚ 
        â—â€œreconnectingâ€ï¼šå½“æ’ä»¶å°è¯•é‡æ–°è¿æ¥åˆ°socket.ioæœåŠ¡å™¨æ—¶å‘é€ã€‚ 
        â—â€œreconnect_attemptâ€ï¼šå½“æ’ä»¶å°è¯•é‡æ–°è¿æ¥åˆ°socket.ioæœåŠ¡å™¨æ—¶å‘é€ã€‚ 
        â—â€œreconnect_failedâ€ï¼šé‡æ–°è¿æ¥å°è¯•æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨å¹¶ä¸”ReconnectAttemptè¾¾åˆ°é€‰é¡¹â€œReconnectionAttemptsâ€å€¼æ—¶å‘é€ã€‚ 
        â—â€œerrorâ€ï¼šåœ¨æœåŠ¡å™¨æˆ–å†…éƒ¨æ’ä»¶é”™è¯¯ä¸Šå‘é€ã€‚äº‹ä»¶çš„å”¯ä¸€å‚æ•°æ˜¯BestHTTP.SocketIO.Errorå¯¹è±¡ã€‚
        â— Onceï¼šæ‚¨å¯ä»¥è®¢é˜…ä»…è¢«è°ƒç”¨ä¸€æ¬¡çš„äº‹ä»¶ã€‚manager.Socket.Once(&quot;connect&quot;, OnConnected); 
        â— Off:æ‚¨å¯ä»¥åˆ é™¤æ‰€æœ‰æ´»åŠ¨è®¢é˜…ï¼Œæˆ–åªåˆ é™¤ä¸€ä¸ª
        // åˆ é™¤æ‰€æœ‰çš„å›è°ƒäº‹ä»¶
        manager.Socket.Off(); 
        //ä»&quot;connect&quot;äº‹ä»¶ä¸­åˆ é™¤æ‰€æœ‰å›è°ƒ
        manager.Socket.Off(&quot;connect&quot;); 
        //ä»&quot;connect&quot;äº‹ä»¶ä¸­åˆ é™¤OnConnectedå›è°ƒ
        manager.Socket.Off(&quot;connect&quot;, OnConnected); 
&gt;&gt;&gt;

* 5:Sending events ,æ‚¨å¯ä»¥ä½¿ç”¨â€œEmitâ€åŠŸèƒ½å‘é€äº‹ä»¶ã€‚æ‚¨å¿…é¡»å°†äº‹ä»¶åç§°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å’Œå¯é€‰çš„å…¶ä»–å‚æ•°ä¼ é€’ã€‚è¿™äº›å°†è¢«ç¼–ç ä¸ºjsonå¹¶å°†è¢«å‘é€åˆ°æœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥é€‰æ‹©è®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨æœåŠ¡å™¨å¤„ç†äº‹ä»¶æ—¶è¢«è°ƒç”¨ï¼ˆæ‚¨å¿…é¡»æ­£ç¡®è®¾ç½®æœåŠ¡å™¨ä»£ç æ‰èƒ½å‘å›å›è°ƒå‡½æ•°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Socket.IOæœåŠ¡å™¨ç«¯æ–‡æ¡£ï¼‰ã€‚</code></pre><p>// å‘é€æºå¸¦ 2 ä¸ªå‚æ•°çš„äº‹ä»¶ç»™æœåŠ¡å™¨<br>manager.Socket.Emit(â€œmessageâ€, â€œuserNameâ€, â€œmessageâ€); </p>
<p>// å‘é€æºå¸¦ 2 ä¸ªå‚æ•°çš„å¹¶æœ‰å›è°ƒäº‹ä»¶çš„äº‹ä»¶ç»™æœåŠ¡å™¨<br>manager.Socket.Emit(â€œcustom eventâ€, OnAckCallback, â€œparam 1â€, â€œparam 2â€);<br>void OnAckCallback(Socket socket, Packet originalPacket, params object[] args) { Debug.Log(â€œOnAckCallback!â€); } </p>
<pre><code>æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨å¥—æ¥å­—çš„EmitAckå‡½æ•°å‘æœåŠ¡å™¨å‘å›ç¡®è®¤ã€‚æ‚¨å¿…é¡»ä¼ é€’åŸå§‹æ•°æ®åŒ…å’Œä»»ä½•å¯é€‰æ•°æ®,æ‚¨å¯ä»¥ä¿ç•™å¯¹æ•°æ®åŒ…çš„å¼•ç”¨ï¼Œå¹¶ä»å…¶ä»–ä½ç½®è°ƒç”¨EmitAck:</code></pre><p>manager[â€œ/customNamespaceâ€].On(â€œcustomEventâ€, (socket, packet, args) =&gt; { socket.EmitAck(packet, â€œEventâ€, â€œReceivedâ€, â€œSuccessfullyâ€); }); </p>
<pre><code>* 6:å‘é€äºŒè¿›åˆ¶æ•°æ®æœ‰ 2 ç§æ–¹æ³•
1):é€šè¿‡ä¼ é€’ç»™Emitå‡½æ•°ï¼Œæ’ä»¶å°†æ‰«æå‚æ•°ï¼Œå¦‚æœæ‰¾åˆ°å‚æ•°ï¼Œå®ƒå°†æŠŠå®ƒè½¬æ¢ä¸ºäºŒè¿›åˆ¶é™„ä»¶ï¼ˆå¦‚Socket.IO 1.0ä¸­æ‰€ä»‹ç»çš„ï¼‰ã€‚è¿™æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¸ä¼šå°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå®¢æˆ·ç«¯çš„Base64ç¼–ç å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯è½¬æ¢ä¸ºäºŒè¿›åˆ¶ã€‚</code></pre><p>byte[] data = new byte[10];<br>manager.Socket.Emit(â€œeventWithBinaryâ€, â€œtextual paramâ€, data); </p>
<pre><code>2):å¦‚æœäºŒè¿›åˆ¶æ•°æ®ä½œä¸ºå­—æ®µæˆ–å±æ€§åµŒå…¥å¯¹è±¡ä¸­ï¼Œåˆ™Jsonç¼–ç å™¨å¿…é¡»æ”¯æŒè½¬æ¢ã€‚é»˜è®¤çš„Jsonç¼–ç å™¨æ— æ³•å°†åµŒå…¥çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºJsonï¼Œæ‚¨å¿…é¡»ä½¿ç”¨æ›´é«˜çº§çš„Jsonè§£æå™¨åº“ï¼ˆå¦‚&#39;JSON .NET For Unity&#39; - http://u3d.as/5q2ï¼‰
* 7:æ¥æ”¶äºŒè¿›åˆ¶æ•°æ®
åœ¨Socket.IOæœåŠ¡å™¨ä¸­ï¼Œå½“äºŒè¿›åˆ¶æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œå®ƒå°†ç”¨Jsonå¯¹è±¡ï¼ˆ{&#39;_ placeholder&#39;ï¼štrueï¼Œ&#39;num&#39;ï¼šxyz}ï¼‰æ›¿æ¢æ•°æ®ï¼Œå¹¶å°†äºŒè¿›åˆ¶æ•°æ®å‘é€åˆ°å¦ä¸€ä¸ªæ•°æ®åŒ…ä¸­ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œè¿™äº›æ•°æ®åŒ…å°†è¢«æ”¶é›†å¹¶åˆå¹¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ä¸­ã€‚äºŒè¿›åˆ¶æ•°æ®å°†ä½äºæ•°æ®åŒ…çš„Attachmentså±æ€§ä¸­ã€‚
1):åœ¨è¿™é‡Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨è¿™ä¸ªæ•°æ®åŒ…ï¼š
åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ•°æ®åŒ…çš„Attachmentså±æ€§è®¿é—®æ‰€æœ‰äºŒè¿›åˆ¶æ•°æ®,autoDecodePayloadé»˜è®¤ä¸º true</code></pre><p>Socket.On(â€œframeâ€, OnFrame);<br>void OnFrame(Socket socket, Packet packet, params object[] args) { texture.LoadImage(packet.Attachments[0]); }</p>
<pre><code>2):ç¬¬äºŒä¸ªé€‰é¡¹ä¸å‰ä¸€ä¸ªé€‰é¡¹å‡ ä¹ç›¸åŒï¼Œç•¥æœ‰æ”¹è¿›ï¼šæˆ‘ä»¬ä¸ä¼šå°†å‘é€çš„Jsonå­—ç¬¦ä¸²è§£ç ä¸ºcï¼ƒå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“æœåŠ¡å™¨åªå‘é€äº†äºŒè¿›åˆ¶æ•°æ®ï¼Œæ­¤äº‹ä»¶æ²¡æœ‰å…¶ä»–ä¿¡æ¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è®©æ’ä»¶çŸ¥é“ä¸è§£ç æœ‰æ•ˆè´Ÿè½½</code></pre><p>//è®¢é˜…â€œframeâ€äº‹ä»¶ï¼Œå¹¶å°†autoDecodePayloadæ ‡å¿—è®¾ç½®ä¸ºfalse,ä¸è®©æ’ä»¶è‡ªåŠ¨è§£ç <br>Socket.On(â€œframeâ€, OnFrame, /<em>autoDecodePayload:</em>/ false);<br>void OnFrame(Socket socket, Packet packet, params object[] args) { texture.LoadImage(packet.Attachments[0]); } </p>
<pre><code>3):æˆ‘ä»¬å¯ä»¥å°†&#39;{&#39;_placeholder&#39;ï¼štrueï¼Œ&#39;num&#39;ï¼šxyz}&#39;å­—ç¬¦ä¸²æ›¿æ¢ä¸ºé™„ä»¶åˆ—è¡¨ä¸­é™„ä»¶çš„ç´¢å¼•ã€‚</code></pre><p>Socket.On(â€œframeâ€, OnFrame, /<em>autoDecodePayload:</em>/ false);<br>void OnFrame(Socket socket, Packet packet, params object[] args)<br>{<br>        //ç”¨ç´¢å¼•æ›¿æ¢Jsonå¯¹è±¡<br>        packet.ReconstructAttachmentAsIndex();<br>        // ç°åœ¨ï¼Œå°†Payloadè§£ç ä¸º object[]<br>        args = packet.Decode(socket.Manager.Encoder);<br>        // argsç°åœ¨åªåŒ…å«ä¸€ä¸ªç´¢å¼•å·ï¼ˆå¯èƒ½ä¸º0ï¼‰<br>        byte[] data = packet.Attachments[Convert.ToInt32(args[0])]; texture.LoadImage(data);<br>} </p>
<pre><code>4):æˆ‘ä»¬å¯ä»¥ç”¨é™„ä»¶ä¸­è½¬æ¢ä¸ºBase64ç¼–ç å­—ç¬¦ä¸²çš„äºŒè¿›åˆ¶æ•°æ®æ›¿æ¢&#39;{&#39;_ placeholder&#39;ï¼štrueï¼Œ&#39;num&#39;ï¼šxyz}&#39;å­—ç¬¦ä¸²ã€‚å½“é«˜çº§Jsonè§£æå™¨å¿…é¡»å°†å…¶è®¾ç½®ä¸ºå¯¹è±¡çš„å­—æ®µæˆ–å±æ€§æ—¶ï¼Œå®ƒå¯ä»¥å°†å…¶è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</code></pre><p>Socket.On(â€œframeâ€, OnFrame, /<em>autoDecodePayload:</em>/ false);<br>void OnFrame(Socket socket, Packet packet, params object[] args)<br>{<br>        // ç”¨Base64ç¼–ç çš„å­—ç¬¦ä¸²æ›¿æ¢Jsonå¯¹è±¡ packet.ReconstructAttachmentAsBase64();<br>        // ç°åœ¨ï¼Œå°†Payloadè§£ç ä¸ºobject[]<br>        args = packet.Decode(socket.Manager.Encoder);<br>        // argsç°åœ¨åŒ…å«ä¸€ä¸ªBase64ç¼–ç çš„å­—ç¬¦ä¸²<br>        byte[] data = Convert.FromBase64String(args[0] as string); texture.LoadImage(data);<br>}</p>
<pre><code>* 8:è®¾ç½®é»˜è®¤çš„Jsonç¼–ç å™¨, æ‚¨å¯ä»¥é€šè¿‡å°†SocketManagerçš„é™æ€DefaultEncoderè®¾ç½®ä¸ºæ–°çš„ç¼–ç å™¨æ¥æ›´æ”¹é»˜è®¤çš„Jsonç¼–ç å™¨ã€‚åœ¨æ­¤æ­¥éª¤ä¹‹åï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„SocketManagerå°†ä½¿ç”¨æ­¤ç¼–ç å™¨ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ç›´æ¥å°†SocketManagerå¯¹è±¡çš„Encoderå±æ€§è®¾ç½®ä¸ºç¼–ç å™¨ã€‚
ç¼–å†™è‡ªå®šä¹‰Jsonç¼–ç å™¨:å¦‚æœç”±äºå„ç§åŸå› æƒ³è¦æ›´æ”¹é»˜è®¤çš„Jsonç¼–ç å™¨ï¼Œé¦–å…ˆå¿…é¡»ç¼–å†™ä¸€ä¸ªæ–°çš„Jsonç¼–ç å™¨ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»ç¼–å†™ä¸€ä¸ªæ–°ç±»ï¼Œè¯¥ç±»ä»BestHTTP.SocketIO.JsonEncoderså‘½åç©ºé—´å®ç°IJsonEncoderã€‚å‰¥ç¦»çš„IJsonEncoderéå¸¸å°ï¼Œä½ å¿…é¡»åªå®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼š</code></pre><p>public interface IJsonEncoder<br>{<br>        List<object> Decode(string json);<br>        string Encode(List<object> obj);<br>} </object></object></p>
<pre><code>Decodeå‡½æ•°å¿…é¡»å°†ç»™å®šçš„jsonå­—ç¬¦ä¸²è§£ç ä¸ºå¯¹è±¡åˆ—è¡¨ã€‚ç”±äºSocket.IOåè®®çš„æ€§è´¨ï¼Œå‘é€çš„jsonæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯äº‹ä»¶çš„åç§°ã€‚Encodeå‡½æ•°ç”¨äºç¼–ç å®¢æˆ·ç«¯è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚æ­¤åˆ—è¡¨çš„ç»“æ„ä¸Decodeç›¸åŒï¼šåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯äº‹ä»¶çš„åç§°ï¼Œä»»ä½•å…¶ä»–å…ƒç´ æ˜¯ç”¨æˆ·å‘é€çš„å‚æ•°ã€‚ä¾‹å­:</code></pre><p>using LitJson;<br>public sealed class LitJsonEncoder : IJsonEncoder<br>{<br>        public List<object> Decode(string json)<br>        {<br>                JsonReader reader = new JsonReader(json);<br>                return JsonMapper.ToObject&lt;List<object>&gt;(reader);<br>        }<br>        public string Encode(List<object> obj)<br>        {<br>                JsonWriter writer = new JsonWriter();<br>                JsonMapper.ToJson(obj, writer);<br>                return writer.ToString();<br>        }<br>} </object></object></object></p>
<pre><code>
* 9:AutoDecodePayloadå±æ€§,
å·²ç»åœ¨â€œæ¥æ”¶äºŒè¿›åˆ¶æ•°æ®â€ä¸­è®¨è®ºè¿‡AutoDecodePayloadï¼Œä½†æ˜¯æ‚¨ä¸ä»…å¯ä»¥æŒ‰eventè®¾ç½®æ­¤å€¼ï¼Œè¿˜å¯ä»¥è®¾ç½®æ¯ä¸ªsocketçš„å€¼ã€‚socketå…·æœ‰AutoDecodePayloadå±æ€§ï¼Œè¯¥å±æ€§ç”¨ä½œäº‹ä»¶è®¢é˜…çš„é»˜è®¤å€¼ã€‚å…¶é»˜è®¤å€¼ä¸ºtrue - æ‰€æœ‰Payloadéƒ½å·²è§£ç å¹¶åˆ†æ´¾ç»™äº‹ä»¶è®¢é˜…è€…ã€‚å¦‚æœè®¾ç½®ä¸ºfalseï¼Œæ’ä»¶å°†ä¸è¿›è¡Œè§£ç ï¼Œæ‚¨å¿…é¡»è‡ªå·±å®Œæˆã€‚
ä½ ä¸æƒ³æ¯æ¬¡éƒ½æŠ›å‡ºargsï¼šå½“ç„¶ï¼æ‚¨å¯ä»¥åœ¨Socketå¯¹è±¡ä¸Šè®¾ç½®AutoDecodePayloadï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„Jsonè§£æå™¨å°†Packetçš„Payloadè§£ç ä¸ºå¼ºç±»å‹å¯¹è±¡ã€‚ä½†è¯·è®°ä½ï¼ŒPayloadå°†åŒ…å«äº‹ä»¶çš„åç§°ï¼Œå®ƒæ˜¯ä¸€ä¸ªjsonæ•°ç»„ã€‚ç¤ºä¾‹Payloadå¦‚ä¸‹æ‰€ç¤ºï¼š&#39;[&#39;eventName&#39;ï¼Œ{&#39;field&#39;ï¼š&#39;stringValue&#39;}ï¼Œ{&#39;field&#39;ï¼š1.0}]&#39;ã€‚

* 10:Error handling  å‘ç”ŸæœåŠ¡å™¨ç«¯æˆ–å®¢æˆ·ç«¯é”™è¯¯æ—¶å‘å‡ºâ€œé”™è¯¯â€äº‹ä»¶ã€‚äº‹ä»¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Errorå¯¹è±¡ã€‚è¿™å°†åŒ…å«Codeå±æ€§ä¸­çš„é”™è¯¯ä»£ç å’ŒMessageå±æ€§ä¸­çš„å­—ç¬¦ä¸²æ¶ˆæ¯ã€‚æ­¤ç±»ä¸­çš„ToStringï¼ˆï¼‰å‡½æ•°å·²è¢«é‡å†™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°å†™å‡ºå…¶å†…å®¹ã€‚</code></pre><p>Socket.On(SocketIOEventTypes.Error, OnError);<br>void OnError(Socket socket, Packet packet, params object[] args)<br>{<br>        Error error = args[0] as Error;<br>        switch (error.Code)<br>        {<br>                case SocketIOErrors.User:<br>                        Debug.Log(â€œException in an event handler!â€);<br>                break;<br>                case SocketIOErrors.Internal:<br>                        Debug.Log(â€œInternal error!â€);<br>                break;<br>                default:<br>                        Debug.Log(â€œServer error!â€); break;<br>        }<br>        Debug.Log(error.ToString());<br>} </p>
<pre><code>
* 11:SocketOptionsç±»ä¸­çš„å¯ç”¨é€‰é¡¹,æ‚¨å¯ä»¥å°†SocketOptionså®ä¾‹ä¼ é€’ç»™SocketManagerçš„æ„é€ å‡½æ•°ã€‚æ‚¨å¯ä»¥æ›´æ”¹ä»¥ä¸‹é€‰é¡¹ï¼š
&gt;&gt;&gt;
        1):Reconnectionï¼šæ–­å¼€è¿æ¥åæ˜¯å¦è‡ªåŠ¨é‡æ–°è¿æ¥ã€‚å…¶é»˜è®¤å€¼ä¸ºtrue
        2):ReconnectionAttemptsï¼šæ”¾å¼ƒå‰çš„å°è¯•æ¬¡æ•°ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯Int.MaxValu
        3):ReconnectionDelayï¼šåœ¨å°è¯•é‡æ–°è¿æ¥ä¹‹å‰æœ€åˆç­‰å¾…çš„æ—¶é—´ã€‚å—+/- RandomizationFactorå½±å“ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤åˆå§‹å»¶è¿Ÿå°†åœ¨500msåˆ°1500msä¹‹é—´ã€‚å…¶é»˜è®¤å€¼ä¸º10000æ¯«ç§’ã€‚
        4):ReconnectionDelayMaxï¼šé‡æ–°è¿æ¥ä¹‹é—´ç­‰å¾…çš„æœ€é•¿æ—¶é—´ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæ¯æ¬¡å°è¯•éƒ½ä¼šå¢åŠ é‡æ–°è¿æ¥å»¶è¿Ÿä»¥åŠéšæœºåŒ–ã€‚å…¶é»˜è®¤å€¼ä¸º5000æ¯«ç§’ã€‚
        5):RandomizationFactorï¼šå®ƒå¯ç”¨äºæ§åˆ¶ReconnectionDelayèŒƒå›´ã€‚å…¶é»˜è®¤å€¼ä¸º0.5ï¼Œå¯ä»¥åœ¨0..1å€¼ä¹‹é—´è®¾ç½®
        6)Timeout:å‘å‡ºâ€œconnect_errorâ€å’Œâ€œconnect_timeoutâ€äº‹ä»¶ä¹‹å‰çš„è¿æ¥è¶…æ—¶ã€‚å®ƒä¸æ˜¯åº•å±‚tcpå¥—æ¥å­—çš„è¿æ¥è¶…æ—¶ï¼Œè€Œæ˜¯socket.ioåè®®ã€‚å…¶é»˜è®¤å€¼ä¸º20000ms
        7):AutoConnectï¼šé€šè¿‡å°†æ­¤è®¾ç½®ä¸ºfalseï¼Œæ‚¨å¿…é¡»åœ¨å†³å®šé€‚å½“æ—¶è°ƒç”¨SocketManagerçš„Openï¼ˆï¼‰ã€‚
        8):ConnectWithï¼šSoâ€‹â€‹cketManagerå°†å°è¯•è¿æ¥åˆ°æ­¤å±æ€§çš„ä¼ è¾“é›†ã€‚å®ƒå¯ä»¥æ˜¯TransportTypes.Pollingæˆ–TransportTypes.WebSocket
&gt;&gt;&gt;

# SignalR
* 1:åƒSocket.IOè¿™æ ·çš„SignalRå®ç°ä½¿ç”¨äº†æ’ä»¶çš„åŸºæœ¬åŠŸèƒ½ã€‚ HTTPRequestså’ŒWebSocketsç”¨äºè¿æ¥å’Œé€šä¿¡è¿æ¥æ± ã€‚ Cookieéšè¯·æ±‚ä¸€èµ·å‘é€ï¼Œè®°å½•å™¨ç”¨äºè®°å½•æœ‰å…³åè®®å’Œé”™è¯¯çš„ä¿¡æ¯,SignalRå®ç°çš„åŠŸèƒ½ç®€è¦åˆ—è¡¨ï¼š
&gt;&gt;&gt;
        1):å…¼å®¹æœ€æ–°çš„SignalRæœåŠ¡å™¨å®ç°
        2):å¥½ç”¨çš„ API
        3):ä¼ è¾“å›è°ƒ
        4):é‡æ–°è¿æ¥é€»è¾‘
        5):æ”¯æŒæ‰€æœ‰HubåŠŸèƒ½
&gt;&gt;&gt;</code></pre><p>using BestHTTP.SignalR;<br>Uri uri = new Uri(â€œ<a href="http://besthttpsignalr.azurewebsites.net/raw-connection/&quot;" target="_blank" rel="noopener">http://besthttpsignalr.azurewebsites.net/raw-connection/&quot;</a>);<br>//é€šè¿‡ä»…å°†æœåŠ¡å™¨çš„uriä¼ é€’ç»™æ„é€ å‡½æ•°æ¥åˆ›å»ºæ²¡æœ‰é›†çº¿å™¨çš„è¿æ¥ã€‚<br>Connection signalRConnection = new Connection(uri);<br>//é€šè¿‡å°†é›†çº¿å™¨åç§°ä¼ é€’ç»™æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸é›†çº¿å™¨çš„è¿æ¥ã€‚<br>Connection signalRConnection = new Connection(uri, â€œhub1â€, â€œhub2â€, â€œhubNâ€);<br>//é€šè¿‡å°†Hubå¯¹è±¡ä¼ é€’ç»™æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸Hubçš„è¿æ¥ã€‚<br>Hub hub1 = new Hub(â€œhub1â€);<br>Hub hub2 = new Hub(â€œhub2â€);<br>Hub hubN = new Hub(â€œhubNâ€);<br>Connection signalRConnection = new Connection(uri, hub1, hub2, hubN);<br>//åˆ›å»ºConnectionä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨Openï¼ˆï¼‰å‡½æ•°å¼€å§‹è¿æ¥åˆ°æœåŠ¡å™¨<br>signalRConnection.Open(); </p>
<pre><code>* 2:Handling general events Connectionç±»å…è®¸æ‚¨è®¢é˜…å¤šä¸ªäº‹ä»¶ã€‚è¿™äº›äº‹ä»¶å¦‚ä¸‹ï¼š</code></pre><p>//OnConnectedï¼šå½“è¿æ¥ç±»æˆåŠŸè¿æ¥å¹¶ä¸”SignalRåè®®ç”¨äºé€šä¿¡æ—¶ï¼Œå°†è§¦å‘æ­¤äº‹ä»¶ã€‚<br>signalRConnection.OnConnected += (con) =&gt; Debug.Log(â€œConnected to the SignalR server!â€); </p>
<p>//OnClosedï¼šå½“SignalRåè®®å…³é—­æ—¶ï¼Œå°†è§¦å‘æ­¤äº‹ä»¶ï¼Œå¹¶ä¸”ä¸å†å‘é€æˆ–æ¥æ”¶æ›´å¤šæ¶ˆæ¯ã€‚<br>signalRConnection.OnClosed += (con) =&gt; Debug.Log(â€œConnection Closedâ€);<br>//OnErrorï¼šå‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ã€‚å¦‚æœè¿æ¥å·²æ‰“å¼€ï¼Œæ’ä»¶å°†å°è¯•é‡æ–°è¿æ¥ï¼Œå¦åˆ™è¿æ¥å°†å…³é—­ã€‚<br>signalRConnection.OnError += (conn, err) =&gt; Debug.Log(â€œError: â€œ + err); </p>
<p>//OnReconnectingï¼šå¯åŠ¨é‡æ–°è¿æ¥å°è¯•æ—¶ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚åœ¨æ­¤äº‹ä»¶ä¹‹åï¼Œå°†è°ƒç”¨OnErroræˆ–OnReconnectedäº‹ä»¶ã€‚å¯ä»¥åœ¨OnReconnected / OnClosedäº‹ä»¶ä¹‹å‰è§¦å‘å¤šä¸ªOnReconnecting-OnErroräº‹ä»¶å¯¹ï¼Œå› ä¸ºæ’ä»¶å°†å°è¯•åœ¨ç»™å®šæ—¶é—´å†…å¤šæ¬¡é‡æ–°è¿æ¥ã€‚<br>signalRConnection.OnReconnecting += (con) =&gt; Debug.Log(â€œReconnectingâ€); </p>
<p>//OnReconnectedï¼šé‡æ–°è¿æ¥å°è¯•æˆåŠŸæ—¶è§¦å‘ã€‚<br>signalRConnection.OnReconnecting += (con) =&gt; Debug.Log(â€œReconnectedâ€);<br>//OnStateChnagedï¼šè¿æ¥çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ã€‚äº‹ä»¶å¤„ç†ç¨‹åºå°†åŒæ—¶æ¥æ”¶æ—§çŠ¶æ€å’Œæ–°çŠ¶æ€ã€‚<br>signalRConnection.OnStateChanged += (conn, oldState, newState) =&gt; Debug.Log(string.Format(â€œState Changed {0} -&gt; {1}â€, oldState, newState)); </p>
<p>//OnNonHubMessageï¼šå½“æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€éé›†çº¿å™¨æ¶ˆæ¯æ—¶è§¦å‘ã€‚å®¢æˆ·ç«¯åº”è¯¥çŸ¥é“æœåŠ¡å™¨æœŸæœ›çš„æ¶ˆæ¯ç±»å‹ï¼Œå¹¶ä¸”åº”è¯¥ç›¸åº”åœ°è½¬æ¢æ¥æ”¶çš„å¯¹è±¡ã€‚<br>signalRConnection.OnNonHubMessage + =ï¼ˆconï¼Œdataï¼‰= Debug.Logï¼ˆâ€™æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ï¼šâ€™+ data.ToStringï¼ˆï¼‰ï¼‰;</p>
<p>//RequestPreparatorï¼šä¸ºæ¯ä¸ªå‘å‡ºå¹¶å°†å‘é€åˆ°æœåŠ¡å™¨çš„HTTPRequestè°ƒç”¨æ­¤å§”æ‰˜ã€‚å®ƒå¯ç”¨äºè¿›ä¸€æ­¥è‡ªå®šä¹‰è¯·æ±‚ã€‚<br>signalRConnection.RequestPreparator = (con, req, type) =&gt; req.Timeout = TimeSpan.FromSeconds(30); </p>
<pre><code>
* 3:Sending non-Hub  messages </code></pre><p>//å°†éé›†çº¿å™¨æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨å¾ˆå®¹æ˜“ï¼Œå› ä¸ºè°ƒç”¨è¿æ¥å¯¹è±¡ä¸Šçš„å‡½æ•°ï¼š<br>signalRConnection.Send(new { Type = â€œBroadcastâ€, Value = â€œHello SignalR World!â€ }); </p>
<p>//æ­¤å‡½æ•°å°†ä½¿ç”¨Connectionçš„JsonEncoderå°†ç»™å®šå¯¹è±¡ç¼–ç ä¸ºJsonå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚å·²ç¼–ç çš„Jsonå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨SendJsonå‡½æ•°å‘é€<br>signalRConnection.SendJson(â€œ{ Type: â€˜Broadcastâ€™, Value: â€˜Hello SignalR World!â€™ }â€); </p>
<pre><code>
* 4:Hubs,ä¸ºäº†åœ¨å®¢æˆ·ç«¯ä¸Šå®šä¹‰Hubå¯ä»¥ä»æœåŠ¡å™¨è°ƒç”¨çš„æ–¹æ³•ï¼Œå¹¶è°ƒç”¨aä¸Šçš„æ–¹æ³•
æœåŠ¡å™¨ä¸Šçš„é›†çº¿å™¨å¿…é¡»å°†é›†çº¿å™¨æ·»åŠ åˆ°Connectionå¯¹è±¡ã€‚è¿™å¯ä»¥é€šè¿‡å°†é›†çº¿å™¨åç§°æˆ–é›†çº¿å™¨å®ä¾‹æ·»åŠ åˆ°Connectionæ„é€ å‡½æ•°æ¥å®Œæˆï¼Œåœ¨â€œè¿æ¥ç±»â€éƒ¨åˆ†ä¸­è¿›è¡Œäº†æ¼”ç¤º</code></pre><p>//å¯ä»¥é€šè¿‡ç´¢å¼•æˆ–åç§°é€šè¿‡Connectionå¯¹è±¡è®¿é—®Hubå®ä¾‹ã€‚<br>Hub hub = signalRConnection[0];<br>Hub hub = signalRConnection[â€œhubNameâ€]; </p>
<p>// æ³¨å†ŒæœåŠ¡å™¨å¯è°ƒç”¨æ–¹æ³•,è¦å¤„ç†æœåŠ¡å™¨å¯è°ƒç”¨æ–¹æ³•è°ƒç”¨ï¼Œæˆ‘ä»¬å¿…é¡»è°ƒç”¨é›†çº¿å™¨çš„Onå‡½æ•°ï¼š<br>signalRConnection[â€œhubNameâ€].On(â€œjoinedâ€, Joined);<br>void Joined(Hub hub, MethodCallMessage msg) { Debug.log(string.Format(â€œ{0} joined at {1}â€, msg.Arguments[0], msg.Arguments[1])); }</p>
<pre><code>MethodCallMessageæ˜¯æœåŠ¡å™¨å‘é€çš„å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š
&gt;&gt;&gt;
        Hubï¼šåŒ…å«æ–¹æ³•å¿…é¡»è°ƒç”¨çš„é›†çº¿å™¨åç§°çš„å­—ç¬¦ä¸²ã€‚
        Methodï¼šåŒ…å«æ–¹æ³•åç§°çš„å­—ç¬¦ä¸²
        Argumentsï¼šåŒ…å«æ–¹æ³•è°ƒç”¨å‚æ•°çš„å¯¹è±¡æ•°ç»„ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ã€‚
        Stateï¼šåŒ…å«å…¶ä»–è‡ªå®šä¹‰æ•°æ®çš„å­—å…¸
&gt;&gt;&gt;
è¯¥æ’ä»¶å°†ä½¿ç”¨Hubå’ŒMethodå±æ€§å°†æ¶ˆæ¯è·¯ç”±åˆ°æ­£ç¡®çš„é›†çº¿å™¨å’Œäº‹ä»¶å¤„ç†ç¨‹åºã€‚å¤„ç†æ–¹æ³•è°ƒç”¨çš„å‡½æ•°åªèƒ½ä½¿ç”¨Argumentså’ŒStateå±æ€§ã€‚

* 5:Call server-side methods 
è°ƒç”¨æœåŠ¡å™¨ç«¯æ–¹æ³•å¯ä»¥é€šè¿‡è°ƒç”¨Hubçš„Callå‡½æ•°æ¥å®Œæˆã€‚è°ƒç”¨å‡½æ•°é‡è½½ä»¥æ»¡è¶³æ¯ä¸ªéœ€æ±‚ã€‚ Callå‡½æ•°æ˜¯éé˜»å¡å‡½æ•°ï¼Œå®ƒä»¬ä¸ä¼šé˜»å¡ï¼Œç›´åˆ°æœåŠ¡å™¨å‘å›æœ‰å…³è¯¥è°ƒç”¨çš„ä»»ä½•æ¶ˆæ¯ã€‚
* 6:é‡è½½å‡½æ•°:
Callï¼ˆstring methodï¼Œparams object [] argsï¼‰ï¼šè¿™å¯ä»¥ç”¨æ¥ä»¥ä¸€ç§å³å‘å³å¼ƒçš„æ–¹å¼è°ƒç”¨æœåŠ¡å™¨ç«¯å‡½æ•°ã€‚æˆ‘ä»¬ä¸ä¼šæ”¶åˆ°æœ‰å…³æ–¹æ³•è°ƒç”¨æˆåŠŸæˆ–å¤±è´¥çš„ä»»ä½•æ¶ˆæ¯ã€‚å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•&#39;args&#39;å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨æ­¤å‡½æ•°æ¥è°ƒç”¨æ— å‚æ•°æ–¹æ³•</code></pre><p>//åœ¨æ²¡æœ‰ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨æœåŠ¡å™¨ç«¯å‡½æ•°<br>signalRConnection[â€œhubNameâ€].Call(â€œPingâ€);<br>//ä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°è°ƒç”¨æœåŠ¡å™¨ç«¯å‡½æ•°ï¼šâ€™param1â€™å’Œâ€™param2â€™<br>signalRConnection[â€œhubNameâ€].Call(â€œMessageâ€, â€œparam1â€, â€œparam2â€); </p>
<pre><code>Callï¼ˆstring method ï¼ŒOnMethodResultDelegate onResultï¼Œparams object [] argsï¼‰ï¼šæ­¤å‡½æ•°å¯ä»¥ç”¨ä½œå‰ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å‡½æ•°å¯ä»¥ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ï¼Œè¯¥å‚æ•°å°†åœ¨æˆåŠŸè°ƒç”¨æœåŠ¡å™¨ç«¯å‡½æ•°æ—¶è°ƒç”¨ã€‚</code></pre><p>signalRConnection[â€œhubNameâ€].Call(â€œGetValueâ€, OnGetValueDone);<br>void OnGetValueDone(Hub hub, ClientMessage originalMessage, ResultMessage result) { Debug.Log(â€œGetValue executed on the server. Return value of the function:â€ + result.ReturnValue.ToString()); } </p>
<pre><code>æ­¤å›è°ƒå‡½æ•°æ¥æ”¶è°ƒç”¨æ­¤å‡½æ•°çš„Hubï¼Œå‘é€åˆ°æœåŠ¡å™¨çš„åŸå§‹ClientMessageæ¶ˆæ¯ä»¥åŠç”±äºæ–¹æ³•è°ƒç”¨è€Œç”±æœåŠ¡å™¨å‘é€çš„ResultMessageå®ä¾‹ã€‚ ResultMessageå¯¹è±¡åŒ…å«ReturnValueå’ŒStateå±æ€§ã€‚               
å¦‚æœæ–¹æ³•çš„è¿”å›ç±»å‹ä¸ºvoidï¼Œåˆ™ReturnValueä¸ºnull.
Callï¼ˆstring methodï¼ŒOnMethodResultDelegate onResultï¼ŒOnMethodFailedDelegate onErrorï¼Œparams object [] argsï¼‰ï¼šæ­¤å‡½æ•°å¯ç”¨äºæŒ‡å®šå½“æ–¹æ³•æ— æ³•åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ—¶å°†è°ƒç”¨çš„å›è°ƒã€‚ç”±äºæ–¹æ³•è°ƒç”¨ä¸­å­˜åœ¨æœªæ‰¾åˆ°çš„æ–¹æ³•ï¼Œé”™è¯¯çš„å‚æ•°æˆ–æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå› æ­¤å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœ</code></pre><p>signalRConnection[â€œhubNameâ€].Call(â€œGetValueâ€, OnGetValueDone, OnGetValueFailed);<br>void OnGetValueFailed(Hub hub, ClientMessage originalMessage, FailureMessage error)<br>{<br>        Debug.Log(â€œGetValue failed. Error message from the server: â€œ + error.ErrorMessage);<br>} </p>
<pre><code> FailureMessageåŒ…å«ä»¥ä¸‹å±æ€§ï¼š
 &gt;&gt;&gt;
        â—‹ IsHubErrorï¼šå¦‚æœæ˜¯Hubé”™è¯¯ï¼Œåˆ™ä¸ºTrueã€‚ 
        â—‹ ErrorMessageï¼šæœ‰å…³é”™è¯¯æœ¬èº«çš„ç®€çŸ­æ¶ˆæ¯ã€‚ 
        â—‹ StackTraceï¼šå¦‚æœåœ¨æœåŠ¡å™¨ä¸Šæ‰“å¼€äº†è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Šï¼Œåˆ™å®ƒåŒ…å«é”™è¯¯çš„å †æ ˆè·Ÿè¸ªã€‚
        â—‹ AdditionalDataï¼šå¦‚æœå®ƒä¸ä¸ºnullï¼Œåˆ™å®ƒåŒ…å«æœ‰å…³é”™è¯¯çš„å…¶ä»–ä¿¡æ¯ã€‚
 &gt;&gt;&gt;
 Callï¼ˆstring methodï¼ŒOnMethodResultDelegate onResultï¼ŒOnMethodFailedDelegate onErrorï¼ŒOnMethodProgressDelegate onProgressï¼Œparams object [] argsï¼‰ï¼šæ­¤å‡½æ•°å¯ç”¨äºå‘æœåŠ¡å™¨ç«¯æ–¹æ³•è°ƒç”¨æ·»åŠ å…¶ä»–è¿›åº¦æ¶ˆæ¯å¤„ç†ç¨‹åºã€‚å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä½œä¸šï¼ŒæœåŠ¡å™¨å¯ä»¥å°†è¿›åº¦æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</code></pre><p> signalRConnection[â€œhubNameâ€].Call(â€œGetValueâ€, OnGetValueDone, OnGetValueFailed, OnGetValueProgress);<br> void OnGetValueProgress(Hub hub, ClientMessage originalMessage, ProgressMessage progress)<br> {<br>        Debug.Log(string.Format(â€œGetValue progressed: {0}%â€, progress.Progress));<br>}</p>
<pre><code> å½“æ’ä»¶æ”¶åˆ°ResultMessageæˆ–FailureMessageæ—¶ï¼Œå®ƒä¸ä¼šä¸ºè¿™äº›æ¶ˆæ¯ä¹‹åçš„ProgressMessagesæä¾›æœåŠ¡ã€‚

 * 7:ä½¿ç”¨Hubç±»ä½œä¸ºç»§æ‰¿çš„åŸºç±»,Hubç±»å¯ä»¥ç”¨ä½œå°è£…é›†çº¿å™¨åŠŸèƒ½çš„åŸºç±»ã€‚</code></pre><p> class SampleHub : Hub<br> {<br>        // é»˜è®¤æ„é€ å‡½æ•°ã€‚æ¯ä¸ªé›†çº¿å™¨éƒ½å¿…é¡»æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„åç§°.<br>        public SampleHub() :base(â€œSampleHubâ€)<br>        {<br>                // æ³¨å†ŒæœåŠ¡å™¨å¯è°ƒç”¨å‡½æ•°<br>                base.On(â€œClientFunctionâ€, ClientFunctionImplementation);<br>        }<br>        // ç§æœ‰å‡½æ•°å®ç°æœåŠ¡å™¨å¯è°ƒç”¨å‡½æ•°<br>        private void ClientFunctionImplementation(Hub hub, MethodCallMessage msg)<br>        {<br>        // TODO: implement<br>        }<br>        // åŒ…è£…å‡½æ•°è°ƒç”¨æœåŠ¡å™¨ç«¯å‡½æ•°.<br>        public void ServerFunction(string argument)<br>        {<br>                base.Call(â€œServerFunctionâ€, argument);<br>        }<br>}<br> //å¯ä»¥å®ä¾‹åŒ–æ­¤SampleHubå¹¶å°†å…¶ä¼ é€’ç»™Connectionçš„æ„é€ å‡½æ•°ï¼š<br> SampleHub sampleHub = new SampleHub(); Connection signalRConnection = new Connection(Uri, sampleHub); </p>
<pre><code>
 * 8:Authentication
 Connectionç±»å…·æœ‰AuthenticationProviderå±æ€§ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®ç°IAuthenticationProvideræ¥å£çš„å¯¹è±¡,å®ç°è€…å¿…é¡»å®ç°ä»¥ä¸‹å±æ€§å’ŒåŠŸèƒ½
 &gt;&gt;&gt;
        â— bool IsPreAuthRequiredï¼šå¦‚æœåœ¨Connectionç±»å‘æœåŠ¡å™¨å‘å‡ºä»»ä½•è¯·æ±‚ä¹‹å‰å¿…é¡»è¿è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™è¿”å›trueçš„å±æ€§ã€‚ç¤ºä¾‹ï¼šcookieèº«ä»½éªŒè¯å™¨å¿…é¡»è¿”å›falseï¼Œå› ä¸ºå®ƒå¿…é¡»å‘é€ç”¨æˆ·å‡­æ®å¹¶æ¥æ”¶å¿…é¡»éšè¯·æ±‚ä¸€èµ·å‘é€çš„cookieã€‚ 
        â— StartAuthenticationï¼šä»…åœ¨IsPreAuthRequiredä¸ºtrueæ—¶æ‰éœ€è¦çš„å‡½æ•°ã€‚å¦åˆ™å®ƒä¸ä¼šè¢«è°ƒç”¨ã€‚ 
        â— PrepareRequestï¼šä½¿ç”¨è¯·æ±‚å’Œè¯·æ±‚ç±»å‹æšä¸¾è°ƒç”¨çš„å‡½æ•°ã€‚æ­¤å‡½æ•°å¯ç”¨äºåœ¨å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰å‡†å¤‡ã€‚ 
        â— OnAuthenticationSuccededï¼šIsPreAuthRequiredä¸ºtrueä¸”èº«ä»½éªŒè¯è¿‡ç¨‹æˆåŠŸæ—¶å¿…é¡»è°ƒç”¨çš„äº‹ä»¶ã€‚ 
        â— OnAuthenticationFailedï¼šIsPreAuthRequiredä¸ºtrueä¸”èº«ä»½éªŒè¯è¿‡ç¨‹å¤±è´¥æ—¶å¿…é¡»è°ƒç”¨çš„äº‹ä»¶ã€‚
 &gt;&gt;&gt;
 ä¸€ä¸ªéå¸¸ç®€å•çš„åŸºäºHeaderçš„èº«ä»½éªŒè¯å™¨çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</code></pre><p>class HeaderAuthenticator : IAuthenticationProvider<br>{<br>        public string User { get; private set; }<br>        public string Roles { get; private set; }<br>        // æ­¤ç±»èº«ä»½éªŒè¯ä¸éœ€è¦é¢„å…ˆéªŒè¯æ­¥éª¤<br>        public bool IsPreAuthRequired { get { return false; } }<br>        //æœªä½¿ç”¨çš„äº‹ä»¶ï¼Œå› ä¸ºIsPreAuthRequiredä¸ºfalse<br>        public event OnAuthenticationSuccededDelegate OnAuthenticationSucceded;<br>        //æœªä½¿ç”¨çš„äº‹ä»¶ï¼Œå› ä¸ºIsPreAuthRequiredä¸ºfalse<br>        public event OnAuthenticationFailedDelegate OnAuthenticationFailed;<br>        // ä½¿ç”¨ç”¨æˆ·åå’Œè§’è‰²åˆå§‹åŒ–èº«ä»½éªŒè¯å™¨çš„æ„é€ å‡½æ•°.<br>        public HeaderAuthenticator(string  user, string roles)<br>        {<br>                this.User = user; this.Roles = roles;<br>        }<br>        //æœªä½¿ç”¨çš„äº‹ä»¶ï¼Œå› ä¸ºIsPreAuthRequiredä¸ºfalse<br>        public void StartAuthentication() { }<br>        // é€šè¿‡å‘å…¶æ·»åŠ ä¸¤ä¸ªæ ‡å¤´æ¥å‡†å¤‡è¯·æ±‚<br>        public void PrepareRequest(BestHTTP.HTTPRequest request, RequestTypes type)<br>        {<br>                request.SetHeader(â€œusernameâ€, this.User); request.SetHeader(â€œrolesâ€, this.Roles);<br>        }<br>}</p>
<pre><code> ä¸Socket.IOçš„Managerç±»ä¸€æ ·ï¼ŒSignalRçš„Connectionç±»å…·æœ‰JsonEncoderå±æ€§ï¼Œä¹Ÿå¯ä»¥è®¾ç½®é™æ€Connection.DefaultEncoderã€‚ JsonEncoderå¿…é¡»ä»BestHTTP.SignalR.JsonEncoderså‘½åç©ºé—´å®ç°IJsonEncoderæ¥å£ã€‚è¯¥è½¯ä»¶åŒ…åŒ…å«ä¸€ä¸ªLitJsonEncoderç¤ºä¾‹ï¼Œä¹Ÿå¯ç”¨äºæŸäº›ç¤ºä¾‹

 ## Server-Sent Events

* 1:Server-Sent Eventsæ˜¯ä¸€ç§åŸºäºå­—ç¬¦ä¸²çš„å•å‘åè®®ã€‚æ•°æ®æ¥è‡ªæœåŠ¡å™¨ï¼Œæ²¡æœ‰é€‰é¡¹å¯ä»¥å‘æœåŠ¡å™¨å‘é€ä»»ä½•å†…å®¹ã€‚å®ƒæ˜¯ä½¿ç”¨æœ€æ–°çš„è‰æ¡ˆå®ç°çš„ã€‚è™½ç„¶åè®®çš„åç§°æ˜¯Server-Sent Eventsï¼Œä½†ç±»æœ¬èº«åä¸ºEventSource,å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¸€æ—¦å‘é€LastEventIdï¼Œæ’ä»¶å°†å°è¯•é‡æ–°è¿æ¥ï¼Œè®©æœåŠ¡å™¨å‘é€ä»»ä½•æˆ‘ä»¬åº”è¯¥æ”¶åˆ°çš„ç¼“å†²æ¶ˆæ¯</code></pre><p>//The EventSource class<br>//EventSourceç±»ä½äºBestHTTP.ServerSentEventså‘½åç©ºé—´ä¸­ï¼š<br>using BestHTTP.ServerSentEvents;<br>var sse = new EventSource(new Uri(â€œ<a href="http://server.com&quot;" target="_blank" rel="noopener">http://server.com&quot;</a>)); </p>
<pre><code>* 2:Properties,è¿™äº›æ˜¯EventSourceç±»çš„å…¬å¼€å…¬å¼€å±æ€§ï¼š
&gt;&gt;&gt;
        â— Uriï¼šè¿™æ˜¯åè®®å°è¯•è¿æ¥çš„ç«¯ç‚¹ã€‚å®ƒæ˜¯é€šè¿‡æ„é€ å‡½æ•°è®¾ç½®çš„ã€‚ 
        â— Stateï¼šEventSourceå¯¹è±¡çš„å½“å‰çŠ¶æ€ã€‚ 
        â— ReconnectionTimeï¼šç­‰å¾…å°è¯•é‡æ–°è¿æ¥å°è¯•çš„æ—¶é—´ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯2ç§’ã€‚ 
        â— LastEventIdï¼šæœ€åæ”¶åˆ°çš„äº‹ä»¶çš„idã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°ä»»ä½•äº‹ä»¶IDï¼Œå®ƒå°†ä¸ºnullã€‚ 
        â— InternalRequestï¼šå°†åœ¨Openå‡½æ•°ä¸­å‘é€çš„å†…éƒ¨HTTPRequestå¯¹è±¡ã€‚
&gt;&gt;&gt;

* 3:äº‹ä»¶</code></pre><p>//OnOpenï¼šæˆåŠŸå‡çº§åè®®æ—¶è°ƒç”¨å®ƒ<br>eventSource.OnOpen += OnEventSourceOpened;<br>void OnEventSourceOpened(EventSource source) { Debug.log(â€œEventSource Opened!â€); } </p>
<p>//OnMessageï¼šå½“å®¢æˆ·ç«¯ä»æœåŠ¡å™¨æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶è°ƒç”¨å®ƒã€‚æ­¤å‡½æ•°å°†æ¥æ”¶ä¸€ä¸ªMessageå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«Dataå±æ€§ä¸­æ¶ˆæ¯çš„æœ‰æ•ˆå†…å®¹ã€‚æ¯æ¬¡å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯æ—¶éƒ½ä¼šè°ƒç”¨æ­¤äº‹ä»¶ï¼Œå³ä½¿æ¶ˆæ¯å…·æœ‰æœ‰æ•ˆçš„äº‹ä»¶åç§°ï¼Œæˆ‘ä»¬ä¹Ÿä¸ºæ­¤äº‹ä»¶åˆ†é…äº†ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼<br>eventSource.OnMessage += OnEventSourceMessage;<br>void OnEventSourceMessage(EventSource source, Message msg) { Debug.log(â€œMessage: â€œ + msg.Data); }</p>
<p>// OnErrorï¼šåœ¨è¿æ¥åˆ°æœåŠ¡å™¨æˆ–å¤„ç†æ•°æ®æµæ—¶é‡åˆ°é”™è¯¯æ—¶è°ƒç”¨<br>eventSource.OnError += OnEventSourceError;<br>void OnEventSourceError(EventSource source, string error) { Debug.log(â€œError: â€œ + error); }</p>
<p>//OnRetryï¼šåœ¨æ’ä»¶å°è¯•é‡æ–°è¿æ¥åˆ°æœåŠ¡å™¨ä¹‹å‰è°ƒç”¨æ­¤å‡½æ•°ã€‚å¦‚æœå‡½æ•°è¿”å›falseï¼Œåˆ™ä¸ä¼šè¿›è¡Œä»»ä½•å°è¯•ï¼Œå¹¶ä¸”å°†å…³é—­EventSourceã€‚<br>eventSource.OnRetry += OnEventSourceRetry;<br>bool OnEventSourceRetry(EventSource source) { // disable retry return false; }</p>
<p>//OnClosedï¼šå½“EventSourceå…³é—­æ—¶ï¼Œå°†è°ƒç”¨æ­¤äº‹ä»¶ã€‚<br>eventSource.OnClosed += OnEventSourceClosed;<br>void OnEventSourceClosed(EventSource source) { Debug.log(â€œEventSource Closed!â€); } </p>
<p>//OnStateChangedï¼šæ¯æ¬¡Stateå±æ€§æ›´æ”¹æ—¶è°ƒç”¨ã€‚<br>eventSource.OnStateChanged += OnEventSourceStateChanged;<br>void OnEventSourceStateChanged(EventSource source, States oldState, States newState) { Debug.log(string.Format(â€œState Changed {0} =&gt; {1}â€, oldSate, newState))); }</p>
<pre><code>
* 4:Functions,è¿™äº›æ˜¯EventSourceå¯¹è±¡çš„å…¬å…±å‡½æ•°ã€‚</code></pre><p>//Open: è°ƒç”¨æ­¤å‡½æ•°ï¼Œæ’ä»¶å°†å¼€å§‹è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‡çº§åˆ°Server-Sent Eventsåè®®ã€‚<br>EventSource eventSource = new EventSource(new Uri(â€œ<a href="http://server.com&quot;" target="_blank" rel="noopener">http://server.com&quot;</a>));<br>eventSource.Open(); </p>
<p>// On:ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯å¯ä»¥è®¢é˜…äº‹ä»¶<br>eventSource.On(â€œuserLogonâ€, OnUserLoggedIn);<br>void OnUserLoggedIn(EventSource source, Message msg) { Debug.log(msg.Data); }</p>
<p>//Off:å®ƒå¯ç”¨äºå–æ¶ˆè®¢é˜…æ´»åŠ¨ã€‚<br>eventSource.Off(â€œuserLogonâ€); </p>
<p>//Close: æ­¤å‡½æ•°å°†å¼€å§‹å…³é—­EventSourceå¯¹è±¡ã€‚<br>eventSource.Close(); </p>
<pre><code>* 5:Message,Messageç±»æ˜¯ä¸€ä¸ªé€»è¾‘å•å…ƒï¼ŒåŒ…å«æœåŠ¡å™¨å¯ä»¥å‘é€çš„æ‰€æœ‰ä¿¡æ¯,Properties:
&gt;&gt;&gt;
     â— Idï¼šå·²å‘é€äº‹ä»¶çš„IDã€‚å¦‚æœæ²¡æœ‰å‘é€idï¼Œåˆ™å¯ä»¥ä¸ºnullã€‚å®ƒè¢«æ’ä»¶ä½¿ç”¨ã€‚ 
     â— äº‹ä»¶ï¼šäº‹ä»¶çš„åç§°ã€‚å¦‚æœæ²¡æœ‰å‘é€äº‹ä»¶åç§°ï¼Œåˆ™å¯ä»¥ä¸ºnullã€‚ 
     â— æ•°æ®ï¼šæ¶ˆæ¯çš„å®é™…æœ‰æ•ˆè´Ÿè½½ã€‚ 
     â— é‡è¯•ï¼šæœåŠ¡å™¨å‘é€æ’ä»¶åœ¨é‡æ–°è¿æ¥å°è¯•ä¹‹å‰åº”ç­‰å¾…çš„æ—¶é—´ã€‚å®ƒè¢«æ’ä»¶ä½¿ç”¨ã€‚
&gt;&gt;&gt;

## ç®€å•ä¾‹å­
â— Upload a picture using forms </code></pre><p>var request = new HTTPRequest(new Uri(â€œ<a href="http://server.com&quot;" target="_blank" rel="noopener">http://server.com&quot;</a>), HTTPMethods.Post, onFinished);<br>request.AddBinaryData(â€œimageâ€, texture.EncodeToPNG(), â€œimage.pngâ€);<br>request.Send(); </p>
<pre><code>â— Upload a picture without forms, sending only the raw data </code></pre><p>var request = new HTTPRequest(new Uri(â€œ<a href="http://server.com&quot;" target="_blank" rel="noopener">http://server.com&quot;</a>), HTTPMethods.Post, onFinished);<br>request.SetHeader(â€œContent-Typeâ€, â€œimage/pngâ€);<br>request.Raw = texture.EncodeToPNG();<br>request.Send(); </p>
<pre><code>â— Add custom header </code></pre><p>var request = new HTTPRequest(new Uri(â€œ<a href="http://server.com&quot;" target="_blank" rel="noopener">http://server.com&quot;</a>), HTTPMethods.Post, onFinished);<br>request.SetHeader(â€œContent-Typeâ€, â€œapplication/json; charset=UTF-8â€);<br>request.RawData = UTF8Encoding.GetBytes(ToJson(data));<br>request.Send(); </p>
<pre><code>â— Display  download progress </code></pre><p>var request = new HTTPRequest(new Uri(â€œ<a href="http://serveroflargefile.net/path&quot;" target="_blank" rel="noopener">http://serveroflargefile.net/path&quot;</a>), (req, resp) =&gt; { Debug.Log(â€œFinished!â€); });<br>request.OnProgress += (req, down, length) =&gt; Debug.Log(string.Format(â€œProgress: {0:P2}â€, down / (float)length));<br>request.Send(); </p>
<pre><code>â— Abort a request </code></pre><p>var request = new HTTPRequest(new Uri(address), (req, resp) =&gt; { // State should be HTTPRequestStates.Aborted if we call Abort() before // itâ€™s finishes Debug.Log(req.State); });<br>request.Send();<br>request.Abort();</p>
<pre><code>â— å¯æ¢å¤ä¸‹è½½çš„èŒƒå›´è¯·æ±‚,ç¬¬ä¸€ä¸ªè¯·æ±‚æ˜¯è·å–æœåŠ¡å™¨åŠŸèƒ½çš„Headè¯·æ±‚ã€‚å½“æ”¯æŒèŒƒå›´è¯·æ±‚æ—¶ï¼Œå°†è°ƒç”¨DownloadCallbackå‡½æ•°ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å®é™…è¯·æ±‚æ¥è·å–å†…å®¹çš„å—ï¼Œå¹¶å°†å›è°ƒå‡½æ•°è®¾ç½®ä¸ºæ­¤å‡½æ•°ã€‚å½“å‰ä¸‹è½½ä½ç½®ä¿å­˜åˆ°PlayerPrefsï¼Œå› æ­¤å³ä½¿åœ¨åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨åä¹Ÿå¯ä»¥æ¢å¤ä¸‹è½½ã€‚</code></pre><p>private const int ChunkSize = 1024 * 1024; // 1 MiB - should be bigger!<br>private string saveTo = â€œdownloaded.binâ€;<br>void StartDownload(string url)<br>{<br>      var headRequest = new HTTPRequest(new Uri(url), HTTPMethods.Head, (request, response) =&gt;<br>      {<br>        if (response == null) Debug.LogError(â€œResponse null. Server unreachable? Try again later.â€);<br>        else {<br>                if (response.StatusCode == 416) Debug.LogError(â€œRequested range not satisfiableâ€); else if (response.StatusCode == 200)<br>                Debug.LogError(â€œPartial content doesnâ€™t supported by the server, content can be downloaded as a whole.â€);<br>                else if (response.HasHeaderWithValue(â€œaccept-rangesâ€,â€noneâ€)) Debug.LogError(â€œServer doesnâ€™t supports the â€˜Rangeâ€™ header! The file canâ€™t be downloaded in parts.â€);<br>                else DownloadCallback(request, response);<br>        }<br>      }<br>      // Range header for our head request<br>      int startPos = PlayerPrefs.GetInt(â€œLastDownloadPositionâ€,0);<br>      headRequest.SetRangeHeader(startPos, startPos + ChunkSize);<br>      headRequest.DisableCache = true; headRequest.Send();<br>} </p>
<p>void DownloadCallback(HTTPRequest request, HTTPResponse response)<br>{<br>        if (response == null) { Debug.LogError(â€œResponse null. Server unreachable, or connection lost? Try again later.â€); return; } var range = response.GetRange();<br>        if (range == null) { Debug.LogError(â€œNo â€˜Content-Rangeâ€™ header returned from the server!â€); return; }<br>        else if (!range.IsValid) { Debug.LogError(â€œNo valid â€˜Content-Rangeâ€™ header returned from the server!â€); return; }<br>        if (request.MethodType != HTTPMethods.Head)<br>        {<br>                string path = Path.Combine(Application.temporaryCachePath,saveTo);<br>                using (FileStream fs = new FileStream(path, FileMode.Append)) fs.Write(response.Data, 0, response.Data.Length);<br>                PlayerPrefs.SetInt(â€œLastDownloadPositionâ€, range.LastBytePos);<br>                Debug.LogWarning(string.Format(â€œDownload Status: {0}-{1}/{2}â€, range.FirstBytePos, range.LastBytePos, range.ContentLength));<br>                if (range.LastBytePos == range.ContentLength - 1) { Debug.LogWarning(â€œDownload finished!â€); return; }<br>        }<br>        var downloadRequest = new HTTPRequest(request.Uri, HTTPMethods.Get, /<em>isKeepAlive:</em>/ true, DownloadCallback);<br>        int nextPos = 0;<br>        if (request.MethodType != HTTPMethods.Head) nextPos = range.LastBytePos + 1; else nextPos = PlayerPrefs.GetInt(â€œLastDownloadPositionâ€, 0);<br>        downloadRequest.SetRangeHeader(nextPos, nextPos + ChunkSize);<br>        downloadRequest.DisableCache = true;<br>        downloadRequest.Send();<br>} </p>
<pre><code>
## å…¶ä»–

* 1:ç¦ç”¨åŠŸèƒ½
&gt;&gt;&gt;
        â—BESTHTTP_DISABLE_COOKIESï¼šä½¿ç”¨æ­¤å®šä¹‰å¯ä»¥ç¦ç”¨æ‰€æœ‰ä¸cookieç›¸å…³çš„ä»£ç ã€‚ä¸ä¼šè¿›è¡Œcookieè§£æï¼Œä¿å­˜å’Œå‘é€ã€‚ 
        â—BESTHTTP_DISABLE_CACHINGï¼šä½¿ç”¨æ­¤å®šä¹‰å¯ä»¥ç¦ç”¨æ‰€æœ‰ä¸ç¼“å­˜ç›¸å…³çš„ä»£ç ã€‚ä¸ä¼šè¿›è¡Œç¼“å­˜æˆ–ç¼“å­˜éªŒè¯ã€‚ 
        â—BESTHTTP_DISABLE_SERVERSENT_EVENTSï¼šå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ç¦ç”¨æœåŠ¡å™¨å‘é€çš„äº‹ä»¶ã€‚ SignalRä¸ä¼šå›é€€åˆ°æ­¤ã€‚ 
        â—BESTHTTP_DISABLE_WEBSOCKETï¼šå¯ä»¥ä½¿ç”¨æ­¤ç¦ç”¨Websocketã€‚ SignalRå’ŒSocket.IOä¸ä¼šä½¿ç”¨æ­¤åè®®ã€‚ 
        â—BESTHTTP_DISABLE_SIGNALRï¼šå°†ç¦ç”¨æ•´ä¸ªSignalRå®æ–½ã€‚ 
        â—BESTHTTP_DISABLE_SIGNALR_COREï¼šå°†ç¦ç”¨SignalR Coreå®æ–½ã€‚ 
        â—BESTHTTP_DISABLE_SOCKETIOï¼šå°†ç¦ç”¨æ•´ä¸ªSocket.IOå®ç°ã€‚ 
        â—BESTHTTP_DISABLE_ALTERNATE_SSLï¼šå¦‚æœæ‚¨æ²¡æœ‰ä¸ºWebSocketä½¿ç”¨HTTPSæˆ–WSSï¼Œæˆ–è€…æ‚¨å¯¹é»˜è®¤å®ç°æ„Ÿåˆ°æ»¡æ„ï¼Œåˆ™å¯ä»¥ç¦ç”¨å¤‡ç”¨sslå¤„ç†ç¨‹åºã€‚ 
        â—BESTHTTP_DISABLE_UNITY_FORMï¼šæ‚¨å¯ä»¥åˆ é™¤å¯¹Unityçš„WWWFormçš„ä¾èµ–ã€‚
&gt;&gt;&gt;
* 2:æ”¯æŒçš„å¹³å°
&gt;&gt;&gt;
        â— WebGL
        â— iOS
        â— Android
        â— Windows Phone 10
        â— WinRT / Metro / Windowsåº”ç”¨å•†åº—åº”ç”¨8.1,10â€¢Windowsï¼ŒLinuxå’ŒMacç‹¬ç«‹ç‰ˆ
&gt;&gt;&gt;
* 3:åœ¨Androidï¼ŒiOSå’Œæ¡Œé¢å¹³å°ä¸Š.netçš„Net SslStreamç”¨äºHTTPSã€‚è¿™å¯ä»¥å¤„ç†å„ç§è¯ä¹¦ï¼Œä½†æœ‰äº›è¯ä¹¦å¯èƒ½ä¼šå¤±è´¥ã€‚è¦æä¾›å¤‡ç”¨è§£å†³æ–¹æ¡ˆBouncyCastleæ†ç»‘åœ¨æ’ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨HTTPRequestå¯¹è±¡ä¸Šå°†UseAlternateSSLè®¾ç½®ä¸ºtrueæ¥ä½¿ç”¨å®ƒã€‚ä½†å®ƒä¹Ÿå¯èƒ½åœ¨ä¸€äº›è®¤è¯ä¸Šå¤±è´¥ã€‚åœ¨Windows Phone 8.1ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰å’ŒWinRTï¼ˆWindowsåº”ç”¨å•†åº—åº”ç”¨ç¨‹åºï¼‰ä¸Šï¼Œå®‰å…¨çš„Tls 1.2åè®®å°†å¤„ç†è¿æ¥ã€‚
</code></pre>
      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ 1487842110@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">Love</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">Title:</span>BestHttpä»‹ç»2</p>
    <p><span class="copy-title">æ–‡ç« å­—æ•°:</span><span class="post-count">7.7k</span></p>
    <p><span class="copy-title">Author:</span><a  title="è¯¸å­ç™¾å®¶-è°çš„å¤©ä¸‹?">è¯¸å­ç™¾å®¶-è°çš„å¤©ä¸‹?</a></p>
    <p><span class="copy-title">Created At:</span>2020-05-11, 11:41:32</p>
    <p><span class="copy-title">Updated At:</span>2020-05-11, 20:48:31</p>
    <span class="copy-title">Url:</span><a class="post-url" href="/2020/05/11/Unity/BestHttp/WebSocket/" title="BestHttpä»‹ç»2">http://yoursite.com/2020/05/11/Unity/BestHttp/WebSocket/</a>
    <p>
        <span class="copy-title">Copyright:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"ç½²å-éå•†ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0"</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '78dbe1e4dd28ca4c4b5e',
            clientSecret: 'e49ada68130b4d709a242b8dd8f4e844b14f35f9',
            repo: 'xinzhuzi.github.io',
            owner: 'xinzhuzi',
            admin: ['xinzhuzi'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('20',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">Â©2016-2019 xinzhuzi</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/xinzhuzi/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">ç›®å½•</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>çˆ±ä½ ,çˆ±ä¸–äºº</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.png" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.png" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*ä½œè€…ã€æ ‡ç­¾çš„è‡ªåŠ¨è¡¥å…¨*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['@æ–°è¯¸å­','@è¯¸å­ç™¾å®¶-è°çš„å¤©ä¸‹?','#hexo','#è¯—è¯éšç¬”','#æ‚é¡¹','#tool','#UnityEditor','#BestHttp',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 542px;
        }
        .nav.fullscreen {
            margin-left: -542px;
        }
        .nav-left {
            width: 150px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 542px;
            margin-left: -542px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 542px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    
    .nav-right nav a.hover > span{
        color: #ffffff !important;
    }
    

    /*åˆ—è¡¨æ ·å¼*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
